service: selfpomodoro-serverless

provider:
  name: aws
  runtime: provided.al2
  region: ap-northeast-1
  stage: ${opt:stage, 'dev'}
  profile: selfpomodoro-dev
  versionFunctions: false

  environment:
    DB_HOST: ${env:DB_HOST}
    DB_PORT: ${env:DB_PORT}
    DB_USER: ${env:DB_USER}
    DB_PASSWORD: ${env:DB_PASSWORD}
    DB_NAME: ${env:DB_NAME}
    DB_SSL_MODE: ${env:DB_SSL_MODE}
    COGNITO_USER_POOL_ID: ${env:COGNITO_USER_POOL_ID}
    COGNITO_CLIENT_ID: ${env:COGNITO_CLIENT_ID}
    DYNAMO_USER_CONFIG_TABLE: ${env:DYNAMO_USER_CONFIG_TABLE}
    DYNAMO_ROUND_OPTIMIZATION_TABLE: ${env:DYNAMO_ROUND_OPTIMIZATION_TABLE}
    DYNAMO_SESSION_OPTIMIZATION_TABLE: ${env:DYNAMO_SESSION_OPTIMIZATION_TABLE}
    SQS_ROUND_OPTIMIZATION_URL: ${env:SQS_ROUND_OPTIMIZATION_URL}
    SQS_SESSION_OPTIMIZATION_URL: ${env:SQS_SESSION_OPTIMIZATION_URL}
    LOG_LEVEL: ${env:LOG_LEVEL}
    ENVIRONMENT: ${env:ENVIRONMENT}

functions:
  api-tasks:
    handler: bootstrap
    package:
      artifact: functions/api-tasks/bootstrap.zip
    events:
      # タスク一覧取得
      - http:
          path: /api/v1/tasks
          method: get
          cors: true
      # タスク作成
      - http:
          path: /api/v1/tasks
          method: post
          cors: true
      # タスク更新
      - http:
          path: /api/v1/tasks/{task_id}/edit
          method: patch
          cors: true
      # タスク完了状態切り替え
      - http:
          path: /api/v1/tasks/{task_id}/toggle
          method: patch
          cors: true
      # タスク削除
      - http:
          path: /api/v1/tasks/{task_id}
          method: delete
          cors: true

  api-sessions:
    handler: bootstrap
    package:
      artifact: functions/api-sessions/bootstrap.zip
    events:
      # セッション一覧取得
      - http:
          path: /api/v1/sessions
          method: get
          cors: true
      # セッション開始
      - http:
          path: /api/v1/sessions
          method: post
          cors: true
      # セッション取得
      - http:
          path: /api/v1/sessions/{session_id}
          method: get
          cors: true
      # セッション完了
      - http:
          path: /api/v1/sessions/{session_id}/complete
          method: patch
          cors: true
      # セッション削除
      - http:
          path: /api/v1/sessions/{session_id}
          method: delete
          cors: true

  api-rounds:
    handler: bootstrap
    package:
      artifact: functions/api-rounds/bootstrap.zip
    events:
      # セッションのラウンド一覧取得
      - http:
          path: /api/v1/sessions/{session_id}/rounds
          method: get
          cors: true
      # ラウンド開始
      - http:
          path: /api/v1/sessions/{session_id}/rounds
          method: post
          cors: true
      # ラウンド取得
      - http:
          path: /api/v1/rounds/{round_id}
          method: get
          cors: true
      # ラウンド完了
      - http:
          path: /api/v1/rounds/{round_id}/complete
          method: patch
          cors: true
      # ラウンド中止
      - http:
          path: /api/v1/rounds/{round_id}/abort
          method: post
          cors: true

  api-statistics:
    handler: bootstrap
    package:
      artifact: functions/api-statistics/bootstrap.zip
    events:
      # 集中度トレンド取得
      - http:
          path: /api/v1/statistics/focus-trend
          method: get
          cors: true
      # 集中度ヒートマップ取得
      - http:
          path: /api/v1/statistics/focus-heatmap
          method: get
          cors: true

package:
  individually: true
